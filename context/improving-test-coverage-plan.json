{
  "plan_name": "Improving Test Coverage",
  "last_updated": "2025-12-01T08:45:00Z",
  "goal": "Target: 90%+ overall line coverage",
  "session_startup": [
    "Run git status to check branch",
    "Run ./script/test to verify baseline",
    "Read this file to find current task",
    "Find first task where status=pending and blocked_by=null"
  ],
  "tasks": [
    {
      "id": "check-cmd-coverage",
      "name": "Add E2E tests for check command",
      "status": "complete",
      "priority": 1,
      "blocked_by": null,
      "output_file": "tests/cli_e2e_check.rs",
      "steps": [
        "Write tests for config validation and error handling",
        "Write tests for repository counting and operation display",
        "Write tests for help flags and environment variables",
        "Write tests for basic --updates functionality"
      ],
      "acceptance_criteria": [
        "15 E2E tests in tests/cli_e2e_check.rs",
        "Coverage exceeds 90% target",
        "All tests pass: cargo test cli_e2e_check"
      ],
      "notes": "Remaining: Update display paths that only execute when updates are actually found (requires semantic version tags on test fixtures)"
    },
    {
      "id": "update-cmd-coverage",
      "name": "Add E2E tests for update command",
      "status": "complete",
      "priority": 1,
      "blocked_by": null,
      "output_file": "tests/cli_e2e_update.rs",
      "steps": [
        "Write tests for update display when updates are found",
        "Write tests for --yes flag to bypass interactive prompts",
        "Write tests for actual config file modification",
        "Write tests for breaking change detection with --latest flag",
        "Write tests for compatible update filtering with --compatible flag",
        "Write tests for dry-run mode verification"
      ],
      "acceptance_criteria": [
        "18 E2E tests in tests/cli_e2e_update.rs",
        "Coverage exceeds 90% target",
        "All tests pass: cargo test cli_e2e_update"
      ],
      "notes": "Remaining: Interactive stdin prompt paths (requires stdin mocking), filesystem error handling (requires error injection)"
    },
    {
      "id": "version-coverage",
      "name": "Add tests for version.rs",
      "status": "complete",
      "priority": 2,
      "blocked_by": null,
      "output_file": "src/version.rs",
      "steps": [
        "Write tests for version extraction from git ref formats",
        "Write tests for semver comparison (major, minor, patch)",
        "Write tests for non-semver ref handling",
        "Write tests for version filtering",
        "Write tests for repository dependency collection",
        "Write tests for error cases (invalid versions, missing tags)"
      ],
      "acceptance_criteria": [
        "Coverage exceeds 90% target",
        "All tests pass"
      ]
    },
    {
      "id": "git-coverage",
      "name": "Add tests for git.rs",
      "status": "complete",
      "priority": 2,
      "blocked_by": null,
      "output_file": "src/git.rs",
      "steps": [
        "Write tests for directory removal errors",
        "Write tests for git clone command failures",
        "Write tests for authentication error handling",
        "Write tests for cache loading",
        "Write tests for path filtering",
        "Write tests for tag listing with various formats",
        "Write tests for tag parsing and error handling"
      ],
      "acceptance_criteria": [
        "Coverage exceeds 90% target",
        "All tests pass"
      ]
    },
    {
      "id": "cli-coverage",
      "name": "Add tests for cli.rs",
      "status": "complete",
      "priority": 3,
      "blocked_by": null,
      "output_file": "src/cli.rs",
      "steps": [
        "Ensure all CLI argument paths are tested"
      ],
      "acceptance_criteria": [
        "Perfect coverage achieved",
        "All tests pass"
      ]
    },
    {
      "id": "config-coverage",
      "name": "Add tests for config.rs",
      "status": "complete",
      "priority": 3,
      "blocked_by": null,
      "output_file": "src/config.rs",
      "steps": [
        "Write tests for malformed YAML configurations",
        "Write tests for file I/O errors",
        "Write tests for edge cases in operation parsing",
        "Write tests for validation failures"
      ],
      "acceptance_criteria": [
        "Coverage exceeds 90% target",
        "All tests pass"
      ]
    },
    {
      "id": "operators-coverage",
      "name": "Add tests for operators.rs",
      "status": "complete",
      "priority": 3,
      "blocked_by": null,
      "output_file": "src/operators.rs",
      "steps": [
        "Write test_check_tool_nonzero_exit for tool exit code handling",
        "Write test_check_tool_actual_version_mismatch for version requirement mismatch"
      ],
      "acceptance_criteria": [
        "Near-perfect coverage achieved",
        "All error paths covered except one untestable line (hardcoded regex pattern)",
        "All tests pass"
      ]
    },
    {
      "id": "apply-cmd-coverage",
      "name": "Add tests for apply command",
      "status": "complete",
      "priority": 3,
      "blocked_by": null,
      "output_file": "tests/cli_e2e_apply.rs",
      "steps": [
        "Write E2E tests for apply command functionality"
      ],
      "acceptance_criteria": [
        "Coverage exceeds 90% target",
        "All tests pass"
      ]
    },
    {
      "id": "repository-coverage",
      "name": "Add tests for repository.rs",
      "status": "complete",
      "priority": 3,
      "blocked_by": null,
      "output_file": "src/repository.rs",
      "steps": [
        "Ensure all repository parsing and handling paths are tested"
      ],
      "acceptance_criteria": [
        "Perfect coverage achieved",
        "All tests pass"
      ]
    },
    {
      "id": "cache-coverage",
      "name": "Add tests for cache.rs",
      "status": "complete",
      "priority": 3,
      "blocked_by": null,
      "output_file": "src/cache.rs",
      "steps": [
        "Write tests for cache read/write operations",
        "Write tests for cache key generation"
      ],
      "acceptance_criteria": [
        "Coverage exceeds 90% target",
        "All tests pass"
      ]
    },
    {
      "id": "phases-discovery-errors",
      "name": "Add tests for Phase 1 (Discovery & Cloning) error handling in phases.rs",
      "status": "complete",
      "priority": 2,
      "blocked_by": null,
      "output_file": "src/phases/discovery.rs",
      "steps": [
        "Review existing Phase 1 code paths in phases.rs",
        "Write tests for error handling in discovery",
        "Write tests for cycle detection edge cases",
        "Write tests for config parsing errors",
        "Write tests for network fallback logic"
      ],
      "acceptance_criteria": [
        "All Phase 1 error paths have test coverage",
        "Cycle detection edge cases are tested",
        "All tests pass: cargo test phases"
      ],
      "notes": "Added 21 tests covering: process_config_to_node, detect_cycles, clone_parallel error handling"
    },
    {
      "id": "phases-processing",
      "name": "Add tests for Phase 2 (Processing) in phases.rs",
      "status": "complete",
      "priority": 2,
      "blocked_by": null,
      "output_file": "src/phases/processing.rs",
      "steps": [
        "Review existing Phase 2 code paths in phases.rs",
        "Write tests for cache key generation",
        "Write tests for operation fingerprinting",
        "Write tests for serialization edge cases"
      ],
      "acceptance_criteria": [
        "Cache key generation logic is tested",
        "Operation fingerprinting is tested",
        "Serialization edge cases are covered",
        "All tests pass: cargo test phases"
      ],
      "notes": "Added 41 new tests covering: cache_key_for_node (7 tests), collect_template_vars (5 tests), collect_merge_operations (9 tests), apply_operation (12 tests), process_single_repo (4 tests), execute_phase2 (4 tests)"
    },
    {
      "id": "phases-merge-yaml",
      "name": "Add tests for YAML merge operations in phases.rs",
      "status": "complete",
      "priority": 2,
      "blocked_by": null,
      "output_file": "src/merge/yaml.rs",
      "steps": [
        "Review YAML merge operator implementation",
        "Write tests for nested object merging",
        "Write tests for array merging",
        "Write tests for overwrite modes",
        "Write tests for error paths and edge cases"
      ],
      "acceptance_criteria": [
        "YAML merge operations have comprehensive test coverage",
        "Nested objects, arrays, and overwrite modes are tested",
        "Error paths are covered",
        "All tests pass"
      ],
      "notes": "Added 34 new tests in 6 modules: nested_merging_tests (5 tests), array_edge_case_tests (6 tests), type_overwrite_tests (6 tests), error_path_tests (12 tests), merge_values_direct_tests (6 tests), helper_function_tests (+1 Tagged type test). Total YAML tests: 85"
    },
    {
      "id": "phases-merge-json",
      "name": "Add tests for JSON merge operations in phases.rs",
      "status": "complete",
      "priority": 2,
      "blocked_by": null,
      "output_file": "src/merge/json.rs",
      "steps": [
        "Review JSON merge operator implementation",
        "Write tests for deep merging",
        "Write tests for type conflicts",
        "Write tests for error paths and edge cases"
      ],
      "acceptance_criteria": [
        "JSON merge operations have comprehensive test coverage",
        "Deep merging and type conflicts are tested",
        "Error paths are covered",
        "All tests pass"
      ],
      "notes": "Added 41 new tests in 7 modules: deep_merging_tests (5 tests), type_conflict_tests (8 tests), error_path_tests (8 tests), array_position_tests (5 tests), navigate_edge_case_tests (6 tests), merge_values_direct_tests (6 tests), file_io_helper_tests (5 tests). Total JSON tests: 52"
    },
    {
      "id": "phases-merge-toml",
      "name": "Add tests for TOML merge operations in phases.rs",
      "status": "complete",
      "priority": 2,
      "blocked_by": null,
      "output_file": "src/merge/toml.rs",
      "steps": [
        "Review TOML merge operator implementation",
        "Write tests for section merging",
        "Write tests for array handling",
        "Write tests for error paths and edge cases"
      ],
      "acceptance_criteria": [
        "TOML merge operations have comprehensive test coverage",
        "Section merging and array handling are tested",
        "Error paths are covered",
        "All tests pass"
      ],
      "notes": "Added 45 new tests in 8 modules: deep_section_merging_tests (5 tests), array_edge_case_tests (6 tests), type_overwrite_tests (6 tests), error_path_tests (9 tests), merge_values_direct_tests (7 tests), helper_function_tests (8 tests), parse_path_edge_cases (8 tests), preserve_comments_tests (2 tests). Total TOML tests: 66"
    },
    {
      "id": "phases-merge-ini",
      "name": "Add tests for INI merge operations in phases.rs",
      "status": "complete",
      "priority": 2,
      "blocked_by": null,
      "output_file": "src/merge/ini.rs",
      "steps": [
        "Review INI merge operator implementation",
        "Write tests for section creation",
        "Write tests for key-value updates",
        "Write tests for error paths and edge cases"
      ],
      "acceptance_criteria": [
        "INI merge operations have comprehensive test coverage",
        "Section creation and key-value updates are tested",
        "Error paths are covered",
        "All tests pass"
      ],
      "notes": "Added 31 new tests in 4 modules: apply_ini_merge_operation_tests (+5 tests), error_path_tests (8 tests), helper_function_tests (9 tests), edge_case_tests (13 tests). Total INI tests: 46"
    },
    {
      "id": "phases-merge-markdown",
      "name": "Add tests for Markdown merge operations in phases.rs",
      "status": "complete",
      "priority": 2,
      "blocked_by": null,
      "output_file": "src/merge/markdown.rs",
      "steps": [
        "Review Markdown merge operator implementation",
        "Write tests for header level handling",
        "Write tests for content insertion modes",
        "Write tests for error paths and edge cases"
      ],
      "acceptance_criteria": [
        "Markdown merge operations have comprehensive test coverage",
        "Header levels and content insertion modes are tested",
        "Error paths are covered",
        "All tests pass"
      ],
      "notes": "Added 45 new tests in 5 modules: header_level_tests (10 tests), content_insertion_tests (12 tests), error_path_tests (5 tests), edge_case_tests (11 tests), file_io_helper_tests (11 tests). Total Markdown tests: 60"
    },
    {
      "id": "phases-merge-config",
      "name": "Add tests for merge configuration parsing in phases.rs",
      "status": "complete",
      "priority": 2,
      "blocked_by": null,
      "output_file": "src/phases.rs",
      "steps": [
        "Review merge configuration parsing code",
        "Write tests for configuration parsing",
        "Write tests for file path handling",
        "Write tests for invalid configuration handling"
      ],
      "acceptance_criteria": [
        "Merge configuration parsing is tested",
        "File path handling edge cases are covered",
        "Invalid configuration errors are tested",
        "All tests pass"
      ],
      "notes": "Added 46 new tests: ArrayMergeMode tests (9 tests), merge_config_parsing_tests (17 tests), invalid_merge_config_tests (10 tests), execute_merge_operation_tests (8 tests), merge_filesystem_tests (6 tests). Total new tests: 46"
    },
    {
      "id": "phases-write-disk",
      "name": "Add tests for Phase 6 (Write to Disk) in phases.rs",
      "status": "pending",
      "priority": 2,
      "blocked_by": null,
      "output_file": "src/phases.rs",
      "steps": [
        "Review Phase 6 code paths in phases.rs",
        "Write tests for permission handling edge cases",
        "Write tests for error paths in disk writes"
      ],
      "acceptance_criteria": [
        "Permission handling edge cases are tested",
        "Error paths are covered",
        "All tests pass: cargo test phases"
      ]
    }
  ],
  "module_status": {
    "commands/check.rs": {"target": "90%+", "status": "complete", "notes": "15 E2E tests, exceeds target"},
    "commands/update.rs": {"target": "90%+", "status": "complete", "notes": "18 E2E tests, exceeds target"},
    "commands/apply.rs": {"target": "90%+", "status": "complete", "notes": "Exceeds target"},
    "operators.rs": {"target": "90%+", "status": "complete", "notes": "Near perfect"},
    "config.rs": {"target": "90%+", "status": "complete", "notes": "Exceeds target"},
    "version.rs": {"target": "90%+", "status": "complete", "notes": "Exceeds target"},
    "git.rs": {"target": "90%+", "status": "complete", "notes": "Exceeds target"},
    "cli.rs": {"target": "90%+", "status": "complete", "notes": "Perfect"},
    "repository.rs": {"target": "90%+", "status": "complete", "notes": "Perfect"},
    "cache.rs": {"target": "90%+", "status": "complete", "notes": "Exceeds target"},
    "phases.rs": {"target": "90%+", "status": "in_progress", "notes": "Largest remaining gap - focus on merge operators"}
  },
  "testing_best_practices": [
    "Use descriptive test names: test_module_function_scenario_expected_behavior()",
    "Follow AAA pattern: Arrange, Act, Assert",
    "Use fixtures and helpers to reduce duplication",
    "Test both happy and error paths",
    "Mock external dependencies (git, network) for unit tests",
    "Use integration tests for end-to-end validation",
    "Document test intent with clear comments",
    "Keep tests focused - one behavior per test",
    "Maintain test isolation - no shared mutable state"
  ],
  "notes": [
    "Integration tests are gated behind --features integration-tests",
    "Use cargo tarpaulin --features integration-tests to measure coverage",
    "Priority: error paths, edge cases, and merge operators in phases.rs",
    "Tasks with blocked_by=null can run in parallel",
    "Update status to complete and last_updated when done"
  ]
}

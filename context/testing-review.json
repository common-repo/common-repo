{
  "plan_name": "Testing Review",
  "description": "Improve testing practices to meet OSS best practices",
  "last_updated": "2025-12-31",
  "audit_summary": {
    "current_score": "9/10",
    "pass": ["2.1 Unit tests inline", "2.2 Integration tests in tests/", "2.3 Uses cargo-nextest", "2.4 Doctests run separately", "2.5 Coverage measured (tarpaulin)", "2.6 Coverage target enforced (80%)", "2.7 Test helpers consolidated", "2.8 CI profile configured", "2.9 Snapshot testing (insta)", "2.10 Property-based testing (proptest)"],
    "partial": [],
    "fail": []
  },
  "tasks": [
    {
      "id": "add-doctest-ci-step",
      "name": "Add separate doctest step in CI",
      "status": "complete",
      "priority": 1,
      "blocked_by": null,
      "steps": [
        "Add cargo test --doc step to CI workflow",
        "Run doctests separately from unit tests",
        "Ensure doctests pass before integration tests"
      ],
      "acceptance_criteria": [
        "CI workflow has dedicated doctest step",
        "Doctests run and pass in CI"
      ],
      "completion_notes": "Added 'Run doctests' step in CI test job before nextest. Verified locally: 16 doctests pass, 5 ignored."
    },
    {
      "id": "enforce-coverage-in-ci",
      "name": "Enforce coverage threshold in CI",
      "status": "complete",
      "priority": 1,
      "blocked_by": null,
      "steps": [
        "Add cargo-tarpaulin step to CI workflow",
        "Configure --fail-under 80 threshold",
        "Generate coverage report artifact",
        "Consider adding coverage badge to README"
      ],
      "acceptance_criteria": [
        "CI fails if coverage drops below 80%",
        "Coverage report generated as artifact"
      ],
      "completion_notes": "Added coverage job to CI workflow with cargo-tarpaulin --fail-under 80. Generates HTML and XML reports as artifacts. Current coverage: 89.37%."
    },
    {
      "id": "add-snapshot-testing",
      "name": "Add insta for snapshot testing",
      "status": "complete",
      "priority": 2,
      "blocked_by": null,
      "steps": [
        "Add insta to dev-dependencies",
        "Identify CLI output suitable for snapshot tests",
        "Add snapshot tests for help text output",
        "Add snapshot tests for error message formatting",
        "Document snapshot testing workflow in CONTRIBUTING.md"
      ],
      "acceptance_criteria": [
        "insta is added as dev-dependency",
        "At least 3 snapshot tests exist",
        "Snapshot files committed to repo"
      ],
      "completion_notes": "Added insta v1.41 with yaml feature. Created tests/cli_snapshot_tests.rs with 7 snapshot tests covering main help, subcommand helps (apply, check, ls, init), and error messages (missing config, invalid subcommand). Documented workflow in CONTRIBUTING.md."
    },
    {
      "id": "add-property-testing",
      "name": "Add proptest for property-based testing",
      "status": "complete",
      "priority": 3,
      "blocked_by": null,
      "steps": [
        "Add proptest to dev-dependencies",
        "Identify parsing/validation code suitable for property tests",
        "Add property tests for path handling edge cases",
        "Add property tests for glob pattern matching",
        "Add property tests for YAML/JSON parsing"
      ],
      "acceptance_criteria": [
        "proptest is added as dev-dependency",
        "At least 3 property-based tests exist",
        "Tests cover edge cases in core parsing logic"
      ],
      "completion_notes": "Added proptest v1.5 to dev-dependencies. Created src/path_proptest.rs with 13 property tests covering encode_url_path (5 tests), glob_match (4 tests), and regex_rename (4 tests). Tests verify determinism, character preservation, pattern matching, and capture group handling. All 751 tests pass."
    },
    {
      "id": "consolidate-test-helpers",
      "name": "Consolidate test helpers in shared location",
      "status": "complete",
      "priority": 2,
      "blocked_by": null,
      "steps": [
        "Create tests/common/mod.rs for shared test utilities",
        "Move common fixture setup code to shared module",
        "Create helper macros for common assertions",
        "Document test helper usage"
      ],
      "acceptance_criteria": [
        "tests/common/mod.rs exists",
        "Shared helpers are reused across tests",
        "No duplicate test setup code"
      ],
      "completion_notes": "Created tests/common/mod.rs with TestFixture struct, configs module with common YAML snippets, prelude re-exports, and should_skip_network_tests() helper. Refactored cli_e2e_ls.rs to demonstrate usage. All 738 tests pass."
    },
    {
      "id": "add-test-retry-config",
      "name": "Configure test retries for flaky tests",
      "status": "pending",
      "priority": 3,
      "blocked_by": null,
      "steps": [
        "Review .config/nextest.toml for retry configuration",
        "Add retries=2 for network-dependent tests",
        "Configure appropriate timeouts per test type",
        "Document which tests are allowed to retry"
      ],
      "acceptance_criteria": [
        "nextest.toml has retry configuration",
        "Network tests have appropriate retry settings",
        "Timeouts are configured appropriately"
      ]
    }
  ],
  "notes": [
    "Snapshot testing is particularly valuable for CLI output",
    "Property testing helps find edge cases in parsing",
    "Coverage enforcement should happen after current coverage is measured"
  ]
}

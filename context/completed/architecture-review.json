{
  "plan_name": "Architecture Review",
  "description": "Improve code architecture to meet OSS best practices",
  "last_updated": "2026-01-01",
  "audit_summary": {
    "current_score": "9/10",
    "pass": ["4.4 Clear separation lib/binary", "4.5 Error handling (thiserror+anyhow)", "4.6 Rust API Guidelines naming", "4.7 Standard traits", "4.8 Builder pattern", "4.9 pub(crate) usage", "4.10 cargo xtask"],
    "partial": ["4.1 Workspace layout (single crate, no workspace needed yet)", "4.3 Folder names match crate names"],
    "fail": ["4.2 Workspace dependencies centralized"]
  },
  "tasks": [
    {
      "id": "audit-pub-visibility",
      "name": "Audit and restrict pub visibility",
      "status": "complete",
      "priority": 1,
      "blocked_by": null,
      "steps": [
        "Review all pub items in each module",
        "Identify items that should be pub(crate) instead of pub",
        "Change internal items to pub(crate)",
        "Ensure public API is intentional and documented"
      ],
      "acceptance_criteria": [
        "Internal items use pub(crate)",
        "Public API is minimal and intentional",
        "No accidental public exposure"
      ],
      "completion_notes": "Changed operators nested modules (include, exclude, rename, repo, template, template_vars, tools) to pub(crate). Changed phases submodules (composite, discovery, local_merge, ordering, processing, write) to pub(crate). Changed merge format modules (yaml, json, toml, ini, markdown) to pub(crate). Added public re-exports for discover_repos and merge functions needed by CLI/tests."
    },
    {
      "id": "audit-standard-traits",
      "name": "Audit and implement standard traits",
      "status": "complete",
      "priority": 1,
      "blocked_by": null,
      "steps": [
        "Review all public structs and enums",
        "Add Debug derive where missing",
        "Add Clone where appropriate",
        "Add PartialEq/Eq where meaningful",
        "Consider Display for user-facing types"
      ],
      "acceptance_criteria": [
        "All public types derive Debug",
        "Clone/PartialEq added where appropriate",
        "No missing obvious trait implementations"
      ],
      "completion_notes": "Audited all public types. Added PartialEq+Eq to: config types (Tool, TemplateVars, RepoOp, IncludeOp, ExcludeOp, TemplateOp, RenameMapping, RenameOp, ToolsOp, YamlMergeOp, JsonMergeOp, TomlMergeOp, IniMergeOp, MarkdownMergeOp, Operation), commands (SortOrder, Change), version (UpdateInfo+Eq), phases (RepoNode). All types already had Debug. Clone was already present where appropriate."
    },
    {
      "id": "add-builder-pattern",
      "name": "Add builder pattern for complex types",
      "status": "complete",
      "priority": 2,
      "blocked_by": null,
      "steps": [
        "Identify types with many optional fields",
        "Implement Builder pattern for RepositoryConfig or similar",
        "Use typed-builder or manual implementation",
        "Add examples showing builder usage"
      ],
      "acceptance_criteria": [
        "Complex types have builder methods",
        "Builder usage documented with examples"
      ],
      "completion_notes": "Added fluent builder methods to merge operation types: YamlMergeOp, JsonMergeOp, TomlMergeOp, IniMergeOp, and MarkdownMergeOp. Each struct now has new() constructor and chainable setter methods (source, dest, path, etc.). Includes 8 builder tests verifying functionality. Doc examples added to each new() method."
    },
    {
      "id": "add-cargo-xtask",
      "name": "Add cargo xtask for automation",
      "status": "complete",
      "priority": 3,
      "blocked_by": null,
      "steps": [
        "Create xtask directory with Cargo.toml",
        "Add workspace configuration to root Cargo.toml",
        "Move complex script logic to xtask (coverage, release prep)",
        "Add xtask commands: coverage, release-prep, etc.",
        "Document xtask usage in CONTRIBUTING.md"
      ],
      "acceptance_criteria": [
        "xtask crate exists in workspace",
        "At least 2 xtask commands implemented",
        "Scripts simplified using xtask"
      ],
      "completion_notes": "Created xtask crate with workspace configuration. Added .cargo/config.toml for 'cargo xtask' alias. Implemented two commands: coverage (cargo-tarpaulin integration with format/threshold options) and release-prep (version bumping with dry-run support). Updated CONTRIBUTING.md with xtask documentation."
    },
    {
      "id": "improve-error-types",
      "name": "Review and improve error types",
      "status": "complete",
      "priority": 2,
      "blocked_by": null,
      "steps": [
        "Review error.rs for completeness",
        "Ensure all error variants have meaningful messages",
        "Add context to errors where helpful",
        "Ensure errors are actionable for users"
      ],
      "acceptance_criteria": [
        "All error types documented",
        "Error messages are user-friendly",
        "Errors include context/suggestions"
      ],
      "completion_notes": "Enhanced ConfigParse, GitClone, and Template error variants with optional hint/variable fields for actionable user guidance. Added context-specific hints to 20+ error sites including config validation, repo operations, and template processing. Created new tests for hint and variable display. All tests pass."
    },
    {
      "id": "add-module-documentation",
      "name": "Add module-level documentation",
      "status": "complete",
      "priority": 2,
      "blocked_by": null,
      "steps": [
        "Add //! documentation to each module file",
        "Explain module purpose and contents",
        "Add examples for key modules",
        "Link to related modules"
      ],
      "acceptance_criteria": [
        "All modules have //! documentation",
        "Key modules have usage examples"
      ],
      "completion_notes": "Verified all modules already have comprehensive //! documentation with explanations of purpose and contents. Found 21 existing examples across 7 files (filesystem.rs: 8, config.rs: 6, path.rs: 3, cache.rs: 1, git.rs: 1, merge modules: 2). Added quick example to lib.rs showing MemoryFS usage and config parsing. All doc tests pass."
    }
  ],
  "notes": [
    "Current architecture is reasonable for single-crate project",
    "Workspace would be useful if splitting into multiple crates",
    "xtask is optional but improves developer experience"
  ]
}

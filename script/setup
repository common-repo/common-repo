#!/usr/bin/env bash
# script/setup: Set up application for the first time after cloning, or set it
#               back to the initial first unused state.

set -euo pipefail

cd "$(dirname "$0")/.."

echo "==> Setting up common-repo..."

# Ensure all dependencies are installed
./script/bootstrap

# Install pre-commit hooks (prefer prek if available)
if command -v prek >/dev/null 2>&1; then
  echo "==> Installing pre-commit hooks with prek..."
  prek install
  prek install --hook-type commit-msg
  echo "    Pre-commit hooks installed successfully with prek!"
elif command -v pre-commit >/dev/null 2>&1; then
  echo "==> Installing pre-commit hooks..."
  pre-commit install
  pre-commit install --hook-type commit-msg
  echo "    Pre-commit hooks installed successfully!"
else
  echo "==> Skipping pre-commit hooks (neither prek nor pre-commit installed)"
  echo "    Run './script/bootstrap' to install prek"
fi

# Warm up the build cache
echo "==> Building project to warm cache..."
cargo build

echo "==> Setup complete!"
echo ""
echo "Quick start commands:"
echo "  ./script/test              # Run tests"
echo "  ./script/update            # Update after pulling changes"
echo "  cargo build --release      # Build release binary"
